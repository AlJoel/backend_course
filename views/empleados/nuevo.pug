extends ../layout

block content
  h1= titulo


  form#formNuevoEmpleado

    label(for="username") Usuario
    input#username(type="text" name="username" required)
    br

    label(for="nombre") Nombre
    input#nombre(type="text" name="nombre" required)
    br

    label(for="dni") DNI
    input#dni(type="text" name="dni" required)
    br

    label(for="rol") Rol
    select#rol(name="rol")
      option(value="Administrativo") Administrativo
      option(value="Médico") Médico
    br

    label(for="password") Contraseña
    input#password(type="password" name="password" required)
    br
  
    button(type="submit") Guardar

  script.
    document.getElementById('formNuevoEmpleado').addEventListener('submit', async function(e) {
      e.preventDefault();
      const form = e.target;
      const data = {
        username: form.username.value,
        nombre: form.nombre.value,
        dni: form.dni.value,
        rol: form.rol.value,
        password: form.password.value
      };
      try {
        const res = await fetch('/empleados/agregar', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Accept': 'application/json'
          },
          body: JSON.stringify(data)
        });
        const result = await res.json();
        if (res.ok) {
          window.location.href = '/empleados';
        } else {
          alert(result.mensaje || 'Error al agregar empleado');
        }
      } catch (err) {
        alert('Error de red: ' + err.message);
      }
    });
