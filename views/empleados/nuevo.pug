extends ../layout

block content
    .page-header
        h1= titulo

    form#formNuevoEmpleado.form-card
        .form-group
            label(for="username") Usuario
            input#username(type="text" name="username" required)

        .form-group
            label(for="nombre") Nombre
            input#nombre(type="text" name="nombre" required)

        .form-group
            label(for="dni") DNI
            input#dni(type="text" name="dni" required)

        .form-group
            label(for="rol") Rol
            select#rol(name="rol")
                option(value="Administrativo") Administrativo
                option(value="Médico") Médico

        .form-group
            label(for="password") Contraseña
            input#password(type="password" name="password" required)

        .form-actions
            button(type="submit" class="btn btn-primary") Guardar
            a(href="/empleados" class="btn btn-secondary") Cancelar

    script.
        document.getElementById('formNuevoEmpleado').addEventListener('submit', async function(e) {
            e.preventDefault();
            const form = e.target;
            const data = {
                username: form.username.value,
                nombre: form.nombre.value,
                dni: form.dni.value,
                rol: form.rol.value,
                password: form.password.value
            };
            try {
                const res = await fetch('/empleados/agregar', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
                const result = await res.json();
                if (res.ok) {
                    window.location.href = '/empleados';
                } else {
                    alert(result.mensaje || 'Error al agregar empleado');
                }
            } catch (err) {
                alert('Error de red: ' + err.message);
            }
        });
