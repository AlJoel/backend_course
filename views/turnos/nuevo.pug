extends ../layout

block content
    .page-header
        h1= titulo

    form#formNuevoTurno.form-card
        .form-group
            label(for="dniPaciente") DNI del paciente
            input#dniPaciente(type="text" name="dniPaciente" required)

        .form-group
            label(for="dia") Día
            input#dia(type="date" name="dia" required)

        .form-group
            label(for="hora") Hora
            input#hora(type="time" name="hora" required)

        .form-group
            label(for="motivo") Motivo
            input#motivo(type="text" name="motivo")

        .form-group
            label(for="medicoAsignado") Médico asignado
            if medicos && medicos.length
                select#medicoAsignado(name="medicoAsignado")
                    option(value="") -- Seleccione un médico --
                    each medico in medicos
                        option(value=medico.id)= medico.nombre
            else
                input#medicoAsignado(type="text", name="medicoAsignado", placeholder="ID del médico (no hay médicos cargados)")

        .form-group
            label(for="prioridad") Prioridad (opcional)
            select#prioridad(name="prioridad")
                option(value="baja") baja
                option(value="media" selected) media

        .form-actions
            button(type="submit" class="btn btn-primary") Guardar
            a(href="/turnos" class="btn btn-secondary") Cancelar

    script.
        document.getElementById('formNuevoTurno').addEventListener('submit', async function(e) {
            e.preventDefault();
            const form = e.target;
            const data = {
                dniPaciente: form.dniPaciente.value,
                dia: form.dia.value,
                hora: form.hora.value,
                motivo: form.motivo.value,
                medicoAsignado: form.medicoAsignado.value,
                prioridad: form.prioridad.value
            };
            try {
                const res = await fetch('/turnos/agregar', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
                const result = await res.json();
                if (res.ok) {
                    window.location.href = '/turnos';
                } else {
                    alert(result.mensaje || 'Error al agregar turno');
                }
            } catch (err) {
                alert('Error de red: ' + err.message);
            }
        });
