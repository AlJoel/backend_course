extends ../layout

block content
    .page-header
        h1 Editar paciente

    if paciente
        form#formEditarPaciente(data-id=paciente._id class="form-card")
            .form-group
                label(for="nombre") Nombre
                input(type="text" name="nombre" id="nombre" required value=paciente.nombre)

            .form-group
                label(for="dni") DNI
                input(type="text" name="dni" id="dni" required value=paciente.dni)

            .form-group
                label(for="telefono") Tel√©fono
                input(type="text" name="telefono" id="telefono" required value=paciente.telefono)

            .form-group
                label(for="obraSocial") Obra social
                input(type="text" name="obraSocial" id="obraSocial" required value=paciente.obraSocial)

            .form-actions
                button(type="submit" class="btn btn-primary") Guardar cambios
                a(href="/pacientes" class="btn btn-secondary") Cancelar

        script.
            document.getElementById('formEditarPaciente').addEventListener('submit', async function(e) {
                e.preventDefault();
                const form = e.target;
                const pacienteId = form.getAttribute('data-id');
                const data = {
                    nombre: form.nombre.value,
                    dni: form.dni.value,
                    telefono: form.telefono.value,
                    obraSocial: form.obraSocial.value
                };
                try {
                    const res = await fetch(`/pacientes/${pacienteId}`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                            'Accept': 'application/json'
                        },
                        body: JSON.stringify(data)
                    });
                    const result = await res.json();
                    if (res.ok) {
                        window.location.href = '/pacientes';
                    } else {
                        alert(result.mensaje || 'Error al actualizar paciente');
                    }
                } catch (err) {
                    alert('Error de red: ' + err.message);
                }
            });
    else
        p Paciente no encontrado.
