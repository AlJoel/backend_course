extends ../layout

block content
    .page-header
        h1 Nuevo paciente

    form#formNuevoPaciente.form-card
        .form-group
            label(for="nombre") Nombre
            input(type="text" name="nombre" id="nombre" required)

        .form-group
            label(for="dni") DNI
            input(type="text" name="dni" id="dni" required)

        .form-group
            label(for="telefono") Tel√©fono
            input(type="text" name="telefono" id="telefono" required)

        .form-group
            label(for="obraSocial") Obra social
            input(type="text" name="obraSocial" id="obraSocial" required)

        .form-actions
            button(type="submit" class="btn btn-primary") Guardar
            a(href="/pacientes" class="btn btn-secondary") Cancelar

    script.
        document.getElementById('formNuevoPaciente').addEventListener('submit', async function(e) {
            e.preventDefault();
            const form = e.target;
            const data = {
                nombre: form.nombre.value,
                dni: form.dni.value,
                telefono: form.telefono.value,
                obraSocial: form.obraSocial.value
            };
            try {
                const res = await fetch('/pacientes', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
                const result = await res.json();
                if (res.ok) {
                    window.location.href = '/pacientes';
                } else {
                    alert(result.mensaje || 'Error al agregar paciente');
                }
            } catch (err) {
                alert('Error de red: ' + err.message);
            }
        });
